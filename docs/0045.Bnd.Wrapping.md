version=pmwiki-2.1.18 ordered=1 urlencoded=1
agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:13.0) Gecko/20100101 Firefox/13.0
author=
csum=
ctime=1288194920
host=90.41.241.185
name=Bnd.Wrapping
rev=9
targets=Bnd.CommandLine
text=(:title 12 Wrapping:)%0a%0ahttp://www.aqute.biz/uploads/Code/bnd.png%0a%0a!12 Wrapping%0a%0aThis is a simple example of wrapping a jar with bnd. The basic idea is to create a recipe (a .bnd file) that collects the different resources in the right way.%0a%0aFor example, you want to wrap the WebSocket server from https://github.com/TooTallNate/Java-WebSocket. Download the binary and the sources in Websocket.jar, Websocket-src.zip. Once you have these files, the following code will create the org.websocket bundle%0a%0a  # Wrapped version of Github project TooTallNate/Java-WebSocket%0a  Bundle-SymbolicName: org.websocket%0a  Bundle-DocURL: https://github.com/TooTallNate/Java-WebSocket%0a  Bundle-License: https://github.com/TooTallNate/Java-WebSocket/%0a          blob/8ef67b46ecc927d5521849dcc2d85d10f9789c20/LICENSE%0a  Bundle-Description: This repository contains a barebones \ %0a   WebSocket server and client implementation written \ %0a   in 100%25 Java. The underlying classes are implemented \ %0a   using the Java ServerSocketChannel and SocketChannel \ %0a   classes, which allows for a non-blocking event-driven model \ %0a   (similar to the WebSocket API for web browsers). \ %0a   Implemented WebSocket protocol versions are: Hixie 75, \ %0a   Hixie 76, Hybi 10, and Hybi 17%0a%0a  # websocket does not define a version yet :-(%0a  Bundle-Version: 1.0.2%0a%0a  Include-Resource: @jar/WebSocket.jar, OSGI-OPT/=@jar/WebSocket-src.zip%0a  -exportcontents: org.java_websocket%0a%0a%0aThe documentation headers are optional but very important, just spent the minute to document them since you'll be grateful later.%0a%0aIf the target project does not have a version, makeup a version and maintain it. Notice that in general the recipe will only be used once for each version, it is normally not used in continuous integration builds. However, you normally use it to convert the next version of the project. Crisp versioning is important.%0a%0aThe @@Include-Resource@@ statement unrolls the jars we downloaded in the root of the JAR and in @@OSGI-OPT@@. Since the source code is in the @@src@@ directory in the  @@WebSocket-src.zip@@ file, we put it in the new JAR under @@OSGI-OPT/src@@. This convention is supported by all IDEs to give you direct access to the bundle's source code. Since the binary and the source are kept together, you always have the correct source code available, and usually automatically. It is so convenient that once you're used to this it is hard to imagine a life without source code.%0a%0aThe binaries and sources are not in the final jar but bnd does not yet know what needs to be exported. This can be indicated with the @@-exportcontents@@ instruction. It has the same syntax as @@Export-Package@@ but does not copy from the classpath, it only applies the instruction to the content of the final JAR.%0a%0a!!Project%0aThe easiest way to build these wrappers is to create a project in bndtools called wrappers and create a bnd descriptor for each one. They are then automatically build (look in generated) and you get a lot of help editing the bnd files.%0a%0aYou can also make an ant file but this is not described here (volunteer?). The other possibility is to use bnd from the [[CommandLine]]. In this case the command is:%0a%0a  bnd websocket.bnd%0a%0a!!Manifest%0aApplying this recipe gives the following manifest in a JAR named @@org.websocket.jar@@:%0a%0a  Manifest-Version: 1.0%0a  Bnd-LastModified: 1338190175969%0a  Bundle-Description: This repository contains a barebones WebSocket serve%0a   r and client implementation written in 100%25 Java. The underlying classe%0a   s are implemented using the Java ServerSocketChannel and SocketChannel %0a   classes, which allows for a non-blocking event-driven model (similar to%0a    the WebSocket API for web browsers). Implemented WebSocket protocol ve%0a   rsions are: Hixie 75, Hixie 76, Hybi 10, and Hybi 17%0a  Bundle-DocURL: https://github.com/TooTallNate/Java-WebSocket%0a  Bundle-License: https://github.com/TooTallNate/Java-WebSocket/blob/8ef67%0a b46ecc927d5521849dcc2d85d10f9789c20/LICENSE%0a  Bundle-ManifestVersion: 2%0a  Bundle-Name: org.websocket%0a  Bundle-SymbolicName: org.websocket%0a  Bundle-Version: 1.0.2%0a  Created-By: 1.6.0_27 (Apple Inc.)%0a  Export-Package: org.java_websocket;version="1.0.2"%0a  Include-Resource: @jar/WebSocket.jar, OSGI-OPT/=@jar/WebSocket-src.zip%0a  Private-Package: org.java_websocket.handshake,org.java_websocket.drafts,%0a   org.java_websocket.exceptions,org.java_websocket.util,org.java_websocke%0a   t.framing%0a  Tool: Bnd-1.51.0%0a%0a!!Extra entries on the Classpath%0aOne of the great features of bnd is to use export version from other versions to generate the import ranges. This feature requires that the other JARs are on the classpath. In bndtools you can use the -buildpath. However, you always add entries on the class path per bnd descriptor with the -classpath instruction:%0a%0a  -classpath: dependency.jar, other.jar%0a%0a%0a
time=1338191533
title=12 Wrapping
author:1338191533=
diff:1338191533:1338191485:=51a52,53%0a>   Bundle-Copyright: (c) 2011 All Rights Reserved by aQute SARL, Licensed u%0a>    nder Apache ASL 2.0%0a63a66%0a>   Bundle-Vendor: aQute SARL http://www.aQute.biz%0a
host:1338191533=90.41.241.185
author:1338191485=
diff:1338191485:1338191190:=40,47d39%0a%3c !!Project%0a%3c The easiest way to build these wrappers is to create a project in bndtools called wrappers and create a bnd descriptor for each one. They are then automatically build (look in generated) and you get a lot of help editing the bnd files.%0a%3c %0a%3c You can also make an ant file but this is not described here (volunteer?). The other possibility is to use bnd from the [[CommandLine]]. In this case the command is:%0a%3c %0a%3c   bnd websocket.bnd%0a%3c %0a%3c !!Manifest%0a76,81c68%0a%3c !!Extra entries on the Classpath%0a%3c One of the great features of bnd is to use export version from other versions to generate the import ranges. This feature requires that the other JARs are on the classpath. In bndtools you can use the -buildpath. However, you always add entries on the class path per bnd descriptor with the -classpath instruction:%0a%3c %0a%3c   -classpath: dependency.jar, other.jar%0a%3c %0a%3c %0a---%0a> %0a
host:1338191485=90.41.241.185
author:1338191190=
diff:1338191190:1338191163:=17,22c17,22%0a%3c    WebSocket server and client implementation written \ %0a%3c    in 100%25 Java. The underlying classes are implemented \ %0a%3c    using the Java ServerSocketChannel and SocketChannel \ %0a%3c    classes, which allows for a non-blocking event-driven model \ %0a%3c    (similar to the WebSocket API for web browsers). \ %0a%3c    Implemented WebSocket protocol versions are: Hixie 75, \ %0a---%0a>    WebSocket server and client implementation written \%0a>    in 100%25 Java. The underlying classes are implemented \%0a>    using the Java ServerSocketChannel and SocketChannel \%0a>    classes, which allows for a non-blocking event-driven model \%0a>    (similar to the WebSocket API for web browsers). \%0a>    Implemented WebSocket protocol versions are: Hixie 75, \%0a
host:1338191190=90.41.241.185
author:1338191163=
diff:1338191163:1338191136:=16c16%0a%3c   Bundle-Description: This repository contains a barebones \ %0a---%0a>   Bundle-Description: This repository contains a barebones \%0a
host:1338191163=90.41.241.185
author:1338191136=
diff:1338191136:1338191065:=11c11%0a%3c   # Wrapped version of Github project TooTallNate/Java-WebSocket%0a---%0a>   %0a14,15c14,15%0a%3c   Bundle-License: https://github.com/TooTallNate/Java-WebSocket/%0a%3c           blob/8ef67b46ecc927d5521849dcc2d85d10f9789c20/LICENSE%0a---%0a>   Bundle-License: https://github.com/TooTallNate/Java-WebSocket/ \%0a>          blob/8ef67b46ecc927d5521849dcc2d85d10f9789c20/LICENSE%0a
host:1338191136=90.41.241.185
author:1338191065=
diff:1338191065:1338191041:=
host:1338191065=90.41.241.185
author:1338191041=
diff:1338191041:1308909366:=7,68c7%0a%3c This is a simple example of wrapping a jar with bnd. The basic idea is to create a recipe (a .bnd file) that collects the different resources in the right way.%0a%3c %0a%3c For example, you want to wrap the WebSocket server from https://github.com/TooTallNate/Java-WebSocket. Download the binary and the sources in Websocket.jar, Websocket-src.zip. Once you have these files, the following code will create the org.websocket bundle%0a%3c %0a%3c   %0a%3c   Bundle-SymbolicName: org.websocket%0a%3c   Bundle-DocURL: https://github.com/TooTallNate/Java-WebSocket%0a%3c   Bundle-License: https://github.com/TooTallNate/Java-WebSocket/ \%0a%3c          blob/8ef67b46ecc927d5521849dcc2d85d10f9789c20/LICENSE%0a%3c   Bundle-Description: This repository contains a barebones \%0a%3c    WebSocket server and client implementation written \%0a%3c    in 100%25 Java. The underlying classes are implemented \%0a%3c    using the Java ServerSocketChannel and SocketChannel \%0a%3c    classes, which allows for a non-blocking event-driven model \%0a%3c    (similar to the WebSocket API for web browsers). \%0a%3c    Implemented WebSocket protocol versions are: Hixie 75, \%0a%3c    Hixie 76, Hybi 10, and Hybi 17%0a%3c %0a%3c   # websocket does not define a version yet :-(%0a%3c   Bundle-Version: 1.0.2%0a%3c %0a%3c   Include-Resource: @jar/WebSocket.jar, OSGI-OPT/=@jar/WebSocket-src.zip%0a%3c   -exportcontents: org.java_websocket%0a%3c %0a%3c %0a%3c The documentation headers are optional but very important, just spent the minute to document them since you'll be grateful later.%0a%3c %0a%3c If the target project does not have a version, makeup a version and maintain it. Notice that in general the recipe will only be used once for each version, it is normally not used in continuous integration builds. However, you normally use it to convert the next version of the project. Crisp versioning is important.%0a%3c %0a%3c The @@Include-Resource@@ statement unrolls the jars we downloaded in the root of the JAR and in @@OSGI-OPT@@. Since the source code is in the @@src@@ directory in the  @@WebSocket-src.zip@@ file, we put it in the new JAR under @@OSGI-OPT/src@@. This convention is supported by all IDEs to give you direct access to the bundle's source code. Since the binary and the source are kept together, you always have the correct source code available, and usually automatically. It is so convenient that once you're used to this it is hard to imagine a life without source code.%0a%3c %0a%3c The binaries and sources are not in the final jar but bnd does not yet know what needs to be exported. This can be indicated with the @@-exportcontents@@ instruction. It has the same syntax as @@Export-Package@@ but does not copy from the classpath, it only applies the instruction to the content of the final JAR.%0a%3c %0a%3c Applying this recipe gives the following manifest in a JAR named @@org.websocket.jar@@:%0a%3c %0a%3c   Manifest-Version: 1.0%0a%3c   Bnd-LastModified: 1338190175969%0a%3c   Bundle-Copyright: (c) 2011 All Rights Reserved by aQute SARL, Licensed u%0a%3c    nder Apache ASL 2.0%0a%3c   Bundle-Description: This repository contains a barebones WebSocket serve%0a%3c    r and client implementation written in 100%25 Java. The underlying classe%0a%3c    s are implemented using the Java ServerSocketChannel and SocketChannel %0a%3c    classes, which allows for a non-blocking event-driven model (similar to%0a%3c     the WebSocket API for web browsers). Implemented WebSocket protocol ve%0a%3c    rsions are: Hixie 75, Hixie 76, Hybi 10, and Hybi 17%0a%3c   Bundle-DocURL: https://github.com/TooTallNate/Java-WebSocket%0a%3c   Bundle-License: https://github.com/TooTallNate/Java-WebSocket/blob/8ef67%0a%3c  b46ecc927d5521849dcc2d85d10f9789c20/LICENSE%0a%3c   Bundle-ManifestVersion: 2%0a%3c   Bundle-Name: org.websocket%0a%3c   Bundle-SymbolicName: org.websocket%0a%3c   Bundle-Vendor: aQute SARL http://www.aQute.biz%0a%3c   Bundle-Version: 1.0.2%0a%3c   Created-By: 1.6.0_27 (Apple Inc.)%0a%3c   Export-Package: org.java_websocket;version="1.0.2"%0a%3c   Include-Resource: @jar/WebSocket.jar, OSGI-OPT/=@jar/WebSocket-src.zip%0a%3c   Private-Package: org.java_websocket.handshake,org.java_websocket.drafts,%0a%3c    org.java_websocket.exceptions,org.java_websocket.util,org.java_websocke%0a%3c    t.framing%0a%3c   Tool: Bnd-1.51.0%0a%3c %0a%3c %0a---%0a> TBD%0a\ No newline at end of file%0a
host:1338191041=90.41.241.185
author:1308909366=
diff:1308909366:1288194920:=7d6%0a%3c TBD%0a\ No newline at end of file%0a
host:1308909366=90.37.16.90
author:1288194920=
diff:1288194920:1288194920:=1,6d0%0a%3c (:title 12 Wrapping:)%0a%3c %0a%3c http://www.aqute.biz/uploads/Code/bnd.png%0a%3c %0a%3c !12 Wrapping%0a%3c %0a
host:1288194920=90.41.125.248
