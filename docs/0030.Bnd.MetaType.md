version=pmwiki-2.1.18 ordered=1 urlencoded=1
agent=Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15
author=
csum=
ctime=1300285255
host=90.37.140.173
name=Bnd.MetaType
rev=14
targets=Bnd.Components
text=(:title 08 Metatype:)%0a%0ahttp://www.aqute.biz/uploads/Code/bnd.png%0a%0a!08 Metatype%0a''Version 1.42''%0a%0aThe OSGi Metatype specification provides a language to describe configuration information in an XML file. However, XML is cumbersome to use and eXtreMeLy error prone, and refactoring often finds it hard to change references in XML text files. Especially with DS components managing the relations can be complex, see [[Components]]%0a%0aFor this reason, bnd provides annotations to define the XML based on a ''configuration'' interface. For example, the following interface defines a simple metatype:%0a%0a  package com.acme;%0a  import aQute.bnd.annotation.metatype.*;%0a%0a  @Meta.OCD interface Config {%0a    int port();%0a  }%0a%0aTo turn this into an XML file, the bnd file must contain:%0a%0a  -metatype: *%0a%0aThe wild card will search through the whole bundle but it is possible to limit this to a restricted set of packages to speed up the processing. For example:%0a%0a  -metatype: *Metatype*, com.libs.metatypes%0a%0aIf the previous @@Config@@ interface is present in the output, the output will also contain an XML file at @@OSGI-INF/metatype/com.acme.Config.xml@@. This file will look as follows:%0a%0a  %3cmetatype:MetaData %0a    xmlns:metatype='http://www.osgi.org/xmlns/metatype/v1.1.0'>%0a    %3cOCD %0a      name='Config' %0a      id='aQute.metatype.samples.Config' %0a      localization='aQute.metatype.samples.Config'>%0a      %3cAD %0a        name='Port' %0a        id='port' %0a        cardinality='0' %0a        required='true' %0a        type='Integer'/>%0a    %3c/OCD>%0a    %3cDesignate pid='aQute.metatype.samples.Config'>%0a      %3cObject ocdref='aQute.metatype.samples.Config'/>%0a    %3c/Designate>%0a  %3c/metatype:MetaData>%0a%0abnd leverages the rich type information the Java class files contain. It inspects the returns types and from this it automatically calculates the AD type as well as the cardinality. For example, a method like:%0a%0a   List%3cInteger> ints()%0a%0aProvides an AD of:%0a%0a    %3cAD %0a      name='Ints' %0a      id='ints' %0a      cardinality='-2147483648' %0a      required='true' %0a      type='Integer'/>%0a%0a!!Naming%0abnd attempts to make the names of the OCD and AD human readable by un-camel-casing the id. This means that it uses the upper cases in the id to decide where to use spaces. It also attempts to replace '_' characters with spaces and removes '$'. If the result is not what is wanted, the name can always be explicitly set with the AD.name() field.%0a%0aThe id of the properties is by default derived from the method name. The name space of methods is restricted by the Java language both in character set as well as by the reserved keywords. Therefore, bnd mangles the name of the method to allow the method name to be adapted to common practices in proeprty names.%0a%0a* '$' is removed from the name unless it is followed by another '$', in that case it is a single '$'. This can be used to use Java keywords as a name. For example, @@$new@@ maps to the @@new@@ name. To make the name @@$x@@, use a method with the name @@$$x@@.%0a* '_' is replaced with '.' unless it is followed by another '_', in that case it becomes a single '_'. This is useful for dotted names (@@a.b.c@@ comes from @@a_b_c@@) and to indicate private properties, that is properties that start with a '.'. For example, @@_secret@@ maps to @@.secret@@ and this will be a property that is not registered as a service. %0a%0aFor example:%0a%0a  @OCD%0a  interface Config {%0a    String _password(); // .password - will not be registered as a service%0a    String $new();      // new - keyword%0a  }%0a%0a!!@Meta.OCD%0aThe OCD annotation is necessary to know that an interface is a Metatype interface. It should be used preferably without any parameters (they all have good defaults). However, each default is possible to override. The following table discusses the fields:%0a%0a||@@name@@||String||A human readable name of the component, can be localized if it starts with a %25 sign. The default is a string derived from the id where _, $, or camel casing is used to provide spaces.||%0a||@@id@@||String||The id of the OCD, this will also be used for the pid of the Designate element.||%0a||@@localization@@||String||The localization id of the metatype. This refers to a properties file in the OSGI-INF/i10l/%3clocalization>.properties file that can be augmented with locale information.||%0a||@@description@@||String||A human readable description that can be localized. Default is empty.||%0a||@@factory@@||String||Will treat this OCD as intended to be for a factory configuration. The default is @@false@@||%0a%0a!!@Meta.AD%0aThe @@AD@@ is an optional annotation on methods of a OCD interface. The annotation makes it possible to override the defaults and provide extra information.%0a%0a||@@name@@||String||A human readable name of the attribute, can be localized if it starts with a %25 sign. The default is a string derived from the method name where _, $, or camel casing is used to provide spaces.||%0a||@@id@@||String||The id of the attribute. By default this is the name of the method||%0a||@@description@@||String||A human readable description that can be localized. Default is empty.||%0a||@@type@@||String||The type of the attribute. This must be one of the types defined in the Metatype specification. By default the type will be derived from the return type of the method. If no applicable type can be found then the @@String@@ type is used as final default.||%0a||@@cardinality@@||int||The cardinality of the attribute. If this is negative its absolute indicates maximum number of elements in a Vector. If it is positive it indicates the maximum number of values in an array. Zero indicates a scalar. If not provided, bnd will calculate the cardinality based on the return type. Collections will have a negative large value and arrays have a positive large value.||%0a||@@min@@||String||The minimum value allowed for this attribute. There is no default.||%0a||@@max@@||String||The maximum value allowed for this attribute. There is no default.||%0a||@@deflt@@||String||The default initial value. The default for this is an empty String||%0a||@@required@@||boolean||Indicates if this attribute is required. The default is that attributes are required.||%0a||@@optionLabels@@||String[]||Labels for any values specified in @@optionValues@@. The default value is unset if there are no optionValues are defined. If these are defined, then the labels are calculated from the values by making _, $ into spaces and providing spaces between camel cased words in the values.||%0a||@@optionValues@@||String[]||Optional values. If this field is not set and the return type is an enum type then the values are calculated from the enum members.||%0a%0a%0a!!Runtime conversions%0aThe type support the OSGi Metatype specification is limited to the primitives and strings. So what happens when you use another type? During the build phase, bnd will revert to a 'String' Metatype type. This means that those special types are going to be strings in the dictionary. However, the aQute.bnd.annotation.metatype package contains a helper class that simplifies the usage of properties in runtime. It has a @createConfigurable(Class%3cT> c, Map%3c?,?> props)@@. This method returns an object that implements the given configuration interface. The implementation of these methods uses the properties to provide a value. That is, calling the method abc() on this interface will attempt to find the property "abc". It will then use the actual return type of the method to do conversion from the type in the properties to the return type. This takes generic information into account when present.%0a%0aFor example:%0a%0a  @Meta.OCD%0a  interface Config {%0a    URI[] uris();%0a  }%0a%0a  public void updated( Map%3cString,Object> props) {%0a    config = Configurable.createConfigurable(Config.class,props);%0a    for ( URI URI : config.uris() ) {%0a      ...%0a    }%0a  }%0a%0aThe Metatype specification does not support URIs, so how does this work? Lets first look at the AD:%0a%0a    %3cAD %0a     name='uris' %0a     id='uris' %0a     cardinality='2147483647' %0a     required='true' %0a     type='String'/>%0a%0aAny editor will therefore put an array of strings (String[]) in the properties. When the proxy gets the string, it will therefore have to convert from the String[] -> URI[]. In this case, the URI has a String constructor and is used to do the conversion from String to URI. The converter can handle general array to collection, collection to array, and as indicated, any conversion to an object that has a String constructor.%0a%0aFor convenience there are a number of built int conversions provided that cannot leverage the String constructor:%0a%0a* Pattern - Allows regular expression to be set%0a* Class%3c?> - Tries to load a class through the class loader of the configuration interface%0a* boolean - Converts wrappers and primitive boolean to 0 (false) or non-0 (true) and vice versa.%0a* Numbers - Converts any known Number subclass to another Number subclass, including the primitive types.%0a* Enums - If the return type is an enum, it will use the @@valueOf@@ method to get an instance.%0a%0a!!Example%0aThe following example shows a very simple metatype configuration interface:%0a%0a  package aQute.metatype.samples;%0a  import aQute.bnd.annotation.metatype.Meta.*;%0a  @OCD%0a  public interface Config {%0a    int port();%0a  }%0a%0aIf the bnd.bnd file contains:%0a%0a  -metatype: *%0a%0aThen bnd will detect this class as a Metatype and it generates the following XML in @@OSGi-INF/metatype/aQute.metatype.samples.Config.xml%0a%0a  %3c?xml version='1.0'?>%0a  %3cmetatype:MetaData %0a     xmlns:metatype='http://www.osgi.org/xmlns/metatype/v1.1.0'>%0a    %3cOCD %0a      name='Config' %0a      id='aQute.metatype.samples.Config'   %0a      localization='aQute.metatype.samples.Config'>%0a      %3cAD %0a        name='Port' %0a        id='port' %0a        cardinality='0' %0a        required='true' %0a        type='Integer'/>%0a    %3c/OCD>%0a    %3cDesignate pid='aQute.metatype.samples.Config'>%0a      %3cObject ocdref='aQute.metatype.samples.Config'/>%0a    %3c/Designate>%0a  %3c/metatype:MetaData>%0a%0aAs usual, XML does an outstanding job in obfuscating the interesting parts. If you're using the Apache Felix Webconsole (and if not, why not?) then you can edit this metatype on the web:%0a%0a%25width=500px%25 http://www.aqute.biz/uploads/Bnd/webconsole.png%0a%0aThis metatype can now be used in a simple example that prints the port number:%0a%0a  package aQute.metatype.samples;%0a  import java.util.*;%0a  import org.osgi.service.cm.*;%0a  import aQute.bnd.annotation.component.*;%0a  import aQute.bnd.annotation.metatype.*;%0a%0a  @Component(properties="service.pid=aQute.metatype.samples.Config")%0a  public class Echo implements ManagedService {%0a	%0a    public void updated(Dictionary properties) %0a      throws ConfigurationException {%0a      if ( properties != null ) {%0a        Config config = Configurable.createConfigurable(%0a          Config.class, properties);%0a        System.out.println(config.port());%0a      }%0a    }%0a  }%0a%0aThe editor can get quite rich with the metatype information. For example:%0a%0ahttp://www.aqute.biz/uploads/Bnd/complex.png%0a%0aThis information came from the following Meta interface:%0a%0a  interface SampleConfig {%0a    String _secret();%0a    String $new();%0a    String name();%0a    enum X { A, B, C; }%0a    X x();%0a    int birthYear();%0a    URI uri();%0a    URI[] uris();%0a    Collection%3cURI> curis();%0a    Collection%3cInteger> ints(); // fails on webconsole%0a  } %0a%0a%0aThough this is a big savings over normal fudging with properties, it gets better. The metatyping is fully integrated with DS. In this example, we're using DS to register the Managed Service but this is not necessary because DS will automatically use the name of a component as the PID. So with a component life can be as easy as:%0a%0a  @Component(designate=Config.class)%0a  public class Echo2 {	%0a    @Activate%0a    void activate(Map%3c?,?> properties) throws ConfigurationException {%0a      Config config = Configurable.createConfigurable(%0a         Config.class, properties);%0a      System.out.println(config.port());%0a    }%0a  }%0a%0aNo more strings. Components and metatypes are extensively explained in [[Components]].
time=1300446205
title=08 Metatype
author:1300446205=
diff:1300446205:1300446030:=197,216d196%0a%3c The editor can get quite rich with the metatype information. For example:%0a%3c %0a%3c http://www.aqute.biz/uploads/Bnd/complex.png%0a%3c %0a%3c This information came from the following Meta interface:%0a%3c %0a%3c   interface SampleConfig {%0a%3c     String _secret();%0a%3c     String $new();%0a%3c     String name();%0a%3c     enum X { A, B, C; }%0a%3c     X x();%0a%3c     int birthYear();%0a%3c     URI uri();%0a%3c     URI[] uris();%0a%3c     Collection%3cURI> curis();%0a%3c     Collection%3cInteger> ints(); // fails on webconsole%0a%3c   } %0a%3c %0a%3c %0a
host:1300446205=90.37.140.173
author:1300446030=
diff:1300446030:1300445960:=
host:1300446030=90.37.140.173
author:1300445960=
diff:1300445960:1300445917:=174,175c174,175%0a%3c %25width=500px%25 http://www.aqute.biz/uploads/Bnd/webconsole.png%0a%3c %0a---%0a> http://www.aqute.biz/uploads/Bnd/webconsole.png%0a> %0a
host:1300445960=90.37.140.173
author:1300445917=
diff:1300445917:1300445669:=172,177c172,173%0a%3c As usual, XML does an outstanding job in obfuscating the interesting parts. If you're using the Apache Felix Webconsole (and if not, why not?) then you can edit this metatype on the web:%0a%3c %0a%3c http://www.aqute.biz/uploads/Bnd/webconsole.png%0a%3c %0a%3c This metatype can now be used in a simple example that prints the port number:%0a%3c %0a---%0a> As usual, XML does an outstanding job in obfuscating the interesting parts. This metatype can now be used in a simple example that prints the port number:%0a> %0a
host:1300445917=90.37.140.173
author:1300445669=
diff:1300445669:1300445297:=68,75d67%0a%3c For example:%0a%3c %0a%3c   @OCD%0a%3c   interface Config {%0a%3c     String _password(); // .password - will not be registered as a service%0a%3c     String $new();      // new - keyword%0a%3c   }%0a%3c %0a172,173c164,167%0a%3c As usual, XML does an outstanding job in obfuscating the interesting parts. This metatype can now be used in a simple example that prints the port number:%0a%3c %0a---%0a> As usual, XML does an outstanding job in obfuscating the information.%0a> %0a> This code can now be used in a simple example that prints the port:%0a> %0a
host:1300445669=90.37.140.173
author:1300445297=
diff:1300445297:1300291032:=15c15%0a%3c   @Meta.OCD interface Config {%0a---%0a>   @Metadata.OCD interface Config {%0a60,68c60%0a%3c !!Naming%0a%3c bnd attempts to make the names of the OCD and AD human readable by un-camel-casing the id. This means that it uses the upper cases in the id to decide where to use spaces. It also attempts to replace '_' characters with spaces and removes '$'. If the result is not what is wanted, the name can always be explicitly set with the AD.name() field.%0a%3c %0a%3c The id of the properties is by default derived from the method name. The name space of methods is restricted by the Java language both in character set as well as by the reserved keywords. Therefore, bnd mangles the name of the method to allow the method name to be adapted to common practices in proeprty names.%0a%3c %0a%3c * '$' is removed from the name unless it is followed by another '$', in that case it is a single '$'. This can be used to use Java keywords as a name. For example, @@$new@@ maps to the @@new@@ name. To make the name @@$x@@, use a method with the name @@$$x@@.%0a%3c * '_' is replaced with '.' unless it is followed by another '_', in that case it becomes a single '_'. This is useful for dotted names (@@a.b.c@@ comes from @@a_b_c@@) and to indicate private properties, that is properties that start with a '.'. For example, @@_secret@@ maps to @@.secret@@ and this will be a property that is not registered as a service. %0a%3c %0a%3c !!@Meta.OCD%0a---%0a> !!@Metadata.OCD%0a77c69%0a%3c !!@Meta.AD%0a---%0a> !!@Metadata.AD%0a98c90%0a%3c   @Meta.OCD%0a---%0a>   @OCD%0a100c92%0a%3c     URI[] uris();%0a---%0a>     URL[] urls();%0a105c97%0a%3c     for ( URI URI : config.uris() ) {%0a---%0a>     for ( URL url : config.urls() ) {%0a110,111c102,103%0a%3c The Metatype specification does not support URIs, so how does this work? Lets first look at the AD:%0a%3c %0a---%0a> The Metatype specification does not support URLs, so how does this work? Lets first look at the AD:%0a> %0a113,114c105,106%0a%3c      name='uris' %0a%3c      id='uris' %0a---%0a>      name='Urls' %0a>      id='urls' %0a119,120c111,112%0a%3c Any editor will therefore put an array of strings (String[]) in the properties. When the proxy gets the string, it will therefore have to convert from the String[] -> URI[]. In this case, the URI has a String constructor and is used to do the conversion from String to URI. The converter can handle general array to collection, collection to array, and as indicated, any conversion to an object that has a String constructor.%0a%3c %0a---%0a> Any editor will therefore put an array of strings (String[]) in the properties. When the proxy gets the string, it will therefore have to convert from the String[] -> URL[]. In this case, the URL has a String constructor and is used to do the conversion from String to URL. The converter can handle general array to collection, collection to array, and as indicated, any conversion to an object that has a String constructor.%0a> %0a129,199c121%0a%3c !!Example%0a%3c The following example shows a very simple metatype configuration interface:%0a%3c %0a%3c   package aQute.metatype.samples;%0a%3c   import aQute.bnd.annotation.metatype.Meta.*;%0a%3c   @OCD%0a%3c   public interface Config {%0a%3c     int port();%0a%3c   }%0a%3c %0a%3c If the bnd.bnd file contains:%0a%3c %0a%3c   -metatype: *%0a%3c %0a%3c Then bnd will detect this class as a Metatype and it generates the following XML in @@OSGi-INF/metatype/aQute.metatype.samples.Config.xml%0a%3c %0a%3c   %3c?xml version='1.0'?>%0a%3c   %3cmetatype:MetaData %0a%3c      xmlns:metatype='http://www.osgi.org/xmlns/metatype/v1.1.0'>%0a%3c     %3cOCD %0a%3c       name='Config' %0a%3c       id='aQute.metatype.samples.Config'   %0a%3c       localization='aQute.metatype.samples.Config'>%0a%3c       %3cAD %0a%3c         name='Port' %0a%3c         id='port' %0a%3c         cardinality='0' %0a%3c         required='true' %0a%3c         type='Integer'/>%0a%3c     %3c/OCD>%0a%3c     %3cDesignate pid='aQute.metatype.samples.Config'>%0a%3c       %3cObject ocdref='aQute.metatype.samples.Config'/>%0a%3c     %3c/Designate>%0a%3c   %3c/metatype:MetaData>%0a%3c %0a%3c As usual, XML does an outstanding job in obfuscating the information.%0a%3c %0a%3c This code can now be used in a simple example that prints the port:%0a%3c %0a%3c   package aQute.metatype.samples;%0a%3c   import java.util.*;%0a%3c   import org.osgi.service.cm.*;%0a%3c   import aQute.bnd.annotation.component.*;%0a%3c   import aQute.bnd.annotation.metatype.*;%0a%3c %0a%3c   @Component(properties="service.pid=aQute.metatype.samples.Config")%0a%3c   public class Echo implements ManagedService {%0a%3c 	%0a%3c     public void updated(Dictionary properties) %0a%3c       throws ConfigurationException {%0a%3c       if ( properties != null ) {%0a%3c         Config config = Configurable.createConfigurable(%0a%3c           Config.class, properties);%0a%3c         System.out.println(config.port());%0a%3c       }%0a%3c     }%0a%3c   }%0a%3c %0a%3c Though this is a big savings over normal fudging with properties, it gets better. The metatyping is fully integrated with DS. In this example, we're using DS to register the Managed Service but this is not necessary because DS will automatically use the name of a component as the PID. So with a component life can be as easy as:%0a%3c %0a%3c   @Component(designate=Config.class)%0a%3c   public class Echo2 {	%0a%3c     @Activate%0a%3c     void activate(Map%3c?,?> properties) throws ConfigurationException {%0a%3c       Config config = Configurable.createConfigurable(%0a%3c          Config.class, properties);%0a%3c       System.out.println(config.port());%0a%3c     }%0a%3c   }%0a%3c %0a%3c No more strings. Components and metatypes are extensively explained in [[Components]].%0a\ No newline at end of file%0a---%0a> %0a
host:1300445297=90.37.140.173
author:1300291032=
diff:1300291032:1300290832:=8,9c8,9%0a%3c The OSGi Metatype specification provides a language to describe configuration information in an XML file. However, XML is cumbersome to use and eXtreMeLy error prone, and refactoring often finds it hard to change references in XML text files. Especially with DS components managing the relations can be complex, see [[Components]]%0a%3c %0a---%0a> The OSGi Metatype specification provides a language to describe configuration information in an XML file. However, XML is cumbersome to use and eXtreMeLy error prone, and refactoring often finds it hard to change references in XML text files.%0a> %0a75c75%0a%3c ||@@type@@||String||The type of the attribute. This must be one of the types defined in the Metatype specification. By default the type will be derived from the return type of the method. If no applicable type can be found then the @@String@@ type is used as final default.||%0a---%0a> ||@@type@@||The type of the attribute. This must be one of the types defined in the Metatype specification. By default the type will be derived from the return type of the method. If no applicable type can be found then the @@String@@ type is used as final default.||%0a
host:1300291032=90.42.72.131
author:1300290832=
diff:1300290832:1300290092:=66,68c66,69%0a%3c ||@@description@@||String||A human readable description that can be localized. Default is empty.||%0a%3c ||@@factory@@||String||Will treat this OCD as intended to be for a factory configuration. The default is @@false@@||%0a%3c %0a---%0a> ||@@description@@||A human readble description that can be localized. Default is empty||%0a> ||@@factory@@||String||Will treat this OCD as intended to be for a factory configuration.||%0a> %0a> %0a70,84c71%0a%3c The @@AD@@ is an optional annotation on methods of a OCD interface. The annotation makes it possible to override the defaults and provide extra information.%0a%3c %0a%3c ||@@name@@||String||A human readable name of the attribute, can be localized if it starts with a %25 sign. The default is a string derived from the method name where _, $, or camel casing is used to provide spaces.||%0a%3c ||@@id@@||String||The id of the attribute. By default this is the name of the method||%0a%3c ||@@description@@||String||A human readable description that can be localized. Default is empty.||%0a%3c ||@@type@@||The type of the attribute. This must be one of the types defined in the Metatype specification. By default the type will be derived from the return type of the method. If no applicable type can be found then the @@String@@ type is used as final default.||%0a%3c ||@@cardinality@@||int||The cardinality of the attribute. If this is negative its absolute indicates maximum number of elements in a Vector. If it is positive it indicates the maximum number of values in an array. Zero indicates a scalar. If not provided, bnd will calculate the cardinality based on the return type. Collections will have a negative large value and arrays have a positive large value.||%0a%3c ||@@min@@||String||The minimum value allowed for this attribute. There is no default.||%0a%3c ||@@max@@||String||The maximum value allowed for this attribute. There is no default.||%0a%3c ||@@deflt@@||String||The default initial value. The default for this is an empty String||%0a%3c ||@@required@@||boolean||Indicates if this attribute is required. The default is that attributes are required.||%0a%3c ||@@optionLabels@@||String[]||Labels for any values specified in @@optionValues@@. The default value is unset if there are no optionValues are defined. If these are defined, then the labels are calculated from the values by making _, $ into spaces and providing spaces between camel cased words in the values.||%0a%3c ||@@optionValues@@||String[]||Optional values. If this field is not set and the return type is an enum type then the values are calculated from the enum members.||%0a%3c %0a%3c %0a---%0a> %0a
host:1300290832=90.42.72.131
author:1300290092=
diff:1300290092:1300290010:=67,69c67,70%0a%3c ||@@factory@@||String||Will treat this OCD as intended to be for a factory configuration.||%0a%3c %0a%3c %0a---%0a> ||@@designate@@||String||Provide a pid for this OCD. Otherwise the OCD id is used for the PID. This is recommended for ||%0a> ||@@designateFactory@@||%0a> %0a> %0a
host:1300290092=90.42.72.131
author:1300290010=
diff:1300290010:1300286524:=47,109c47,50%0a%3c bnd leverages the rich type information the Java class files contain. It inspects the returns types and from this it automatically calculates the AD type as well as the cardinality. For example, a method like:%0a%3c %0a%3c    List%3cInteger> ints()%0a%3c %0a%3c Provides an AD of:%0a%3c %0a%3c     %3cAD %0a%3c       name='Ints' %0a%3c       id='ints' %0a%3c       cardinality='-2147483648' %0a%3c       required='true' %0a%3c       type='Integer'/>%0a%3c %0a%3c !!@Metadata.OCD%0a%3c The OCD annotation is necessary to know that an interface is a Metatype interface. It should be used preferably without any parameters (they all have good defaults). However, each default is possible to override. The following table discusses the fields:%0a%3c %0a%3c ||@@name@@||String||A human readable name of the component, can be localized if it starts with a %25 sign. The default is a string derived from the id where _, $, or camel casing is used to provide spaces.||%0a%3c ||@@id@@||String||The id of the OCD, this will also be used for the pid of the Designate element.||%0a%3c ||@@localization@@||String||The localization id of the metatype. This refers to a properties file in the OSGI-INF/i10l/%3clocalization>.properties file that can be augmented with locale information.||%0a%3c ||@@description@@||A human readble description that can be localized. Default is empty||%0a%3c ||@@designate@@||String||Provide a pid for this OCD. Otherwise the OCD id is used for the PID. This is recommended for ||%0a%3c ||@@designateFactory@@||%0a%3c %0a%3c %0a%3c !!@Metadata.AD%0a%3c %0a%3c !!Runtime conversions%0a%3c The type support the OSGi Metatype specification is limited to the primitives and strings. So what happens when you use another type? During the build phase, bnd will revert to a 'String' Metatype type. This means that those special types are going to be strings in the dictionary. However, the aQute.bnd.annotation.metatype package contains a helper class that simplifies the usage of properties in runtime. It has a @createConfigurable(Class%3cT> c, Map%3c?,?> props)@@. This method returns an object that implements the given configuration interface. The implementation of these methods uses the properties to provide a value. That is, calling the method abc() on this interface will attempt to find the property "abc". It will then use the actual return type of the method to do conversion from the type in the properties to the return type. This takes generic information into account when present.%0a%3c %0a%3c For example:%0a%3c %0a%3c   @OCD%0a%3c   interface Config {%0a%3c     URL[] urls();%0a%3c   }%0a%3c %0a%3c   public void updated( Map%3cString,Object> props) {%0a%3c     config = Configurable.createConfigurable(Config.class,props);%0a%3c     for ( URL url : config.urls() ) {%0a%3c       ...%0a%3c     }%0a%3c   }%0a%3c %0a%3c The Metatype specification does not support URLs, so how does this work? Lets first look at the AD:%0a%3c %0a%3c     %3cAD %0a%3c      name='Urls' %0a%3c      id='urls' %0a%3c      cardinality='2147483647' %0a%3c      required='true' %0a%3c      type='String'/>%0a%3c %0a%3c Any editor will therefore put an array of strings (String[]) in the properties. When the proxy gets the string, it will therefore have to convert from the String[] -> URL[]. In this case, the URL has a String constructor and is used to do the conversion from String to URL. The converter can handle general array to collection, collection to array, and as indicated, any conversion to an object that has a String constructor.%0a%3c %0a%3c For convenience there are a number of built int conversions provided that cannot leverage the String constructor:%0a%3c %0a%3c * Pattern - Allows regular expression to be set%0a%3c * Class%3c?> - Tries to load a class through the class loader of the configuration interface%0a%3c * boolean - Converts wrappers and primitive boolean to 0 (false) or non-0 (true) and vice versa.%0a%3c * Numbers - Converts any known Number subclass to another Number subclass, including the primitive types.%0a%3c * Enums - If the return type is an enum, it will use the @@valueOf@@ method to get an instance.%0a%3c %0a%3c %0a---%0a> %0a> %0a> %0a> %0a
host:1300290010=90.42.72.131
author:1300286524=
diff:1300286524:1300285822:=12,14d11%0a%3c   package com.acme;%0a%3c   import aQute.bnd.annotation.metatype.*;%0a%3c %0a25,50c22,28%0a%3c   -metatype: *Metatype*, com.libs.metatypes%0a%3c %0a%3c If the previous @@Config@@ interface is present in the output, the output will also contain an XML file at @@OSGI-INF/metatype/com.acme.Config.xml@@. This file will look as follows:%0a%3c %0a%3c   %3cmetatype:MetaData %0a%3c     xmlns:metatype='http://www.osgi.org/xmlns/metatype/v1.1.0'>%0a%3c     %3cOCD %0a%3c       name='Config' %0a%3c       id='aQute.metatype.samples.Config' %0a%3c       localization='aQute.metatype.samples.Config'>%0a%3c       %3cAD %0a%3c         name='Port' %0a%3c         id='port' %0a%3c         cardinality='0' %0a%3c         required='true' %0a%3c         type='Integer'/>%0a%3c     %3c/OCD>%0a%3c     %3cDesignate pid='aQute.metatype.samples.Config'>%0a%3c       %3cObject ocdref='aQute.metatype.samples.Config'/>%0a%3c     %3c/Designate>%0a%3c   %3c/metatype:MetaData>%0a%3c %0a%3c %0a%3c %0a%3c %0a%3c %0a---%0a>   -metatype: com.acme.*, com.libs.metatypes%0a> %0a> %0a> %0a> %0a> %0a> %0a
host:1300286524=90.42.72.131
author:1300285822=
diff:1300285822:1300285434:=1,2c1,2%0a%3c (:title 08 Metatype:)%0a%3c %0a---%0a> (:title 15 Metatype:)%0a> %0a5c5%0a%3c !08 Metatype%0a---%0a> !15 Metatype%0a8,28c8%0a%3c The OSGi Metatype specification provides a language to describe configuration information in an XML file. However, XML is cumbersome to use and eXtreMeLy error prone, and refactoring often finds it hard to change references in XML text files.%0a%3c %0a%3c For this reason, bnd provides annotations to define the XML based on a ''configuration'' interface. For example, the following interface defines a simple metatype:%0a%3c %0a%3c   @Metadata.OCD interface Config {%0a%3c     int port();%0a%3c   }%0a%3c %0a%3c To turn this into an XML file, the bnd file must contain:%0a%3c %0a%3c   -metatype: *%0a%3c %0a%3c The wild card will search through the whole bundle but it is possible to limit this to a restricted set of packages to speed up the processing. For example:%0a%3c %0a%3c   -metatype: com.acme.*, com.libs.metatypes%0a%3c %0a%3c %0a%3c %0a%3c %0a%3c %0a%3c %0a---%0a> The OSGi Metatype specification provides a language to describe configuration information in an XML file.%0a\ No newline at end of file%0a
host:1300285822=90.42.72.131
author:1300285434=
diff:1300285434:1300285255:=8d7%0a%3c The OSGi Metatype specification provides a language to describe configuration information in an XML file. %0a\ No newline at end of file%0a
host:1300285434=90.42.72.131
author:1300285255=
diff:1300285255:1300285255:=1,7d0%0a%3c (:title 15 Metatype:)%0a%3c %0a%3c http://www.aqute.biz/uploads/Code/bnd.png%0a%3c %0a%3c !15 Metatype%0a%3c ''Version 1.42''%0a%3c %0a
host:1300285255=90.42.72.131
