version=pmwiki-2.1.18 ordered=1 urlencoded=1
agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:5.0b1) Gecko/20100101 Firefox/5.0
author=
csum=
ctime=1308208604
host=90.41.124.174
name=Bnd.Testing
rev=20
targets=
text=(:title 28 Testing:)%0a%0ahttp://www.aqute.biz/uploads/Code/bnd.png%0a%0a!28 Testing%0aThis section describes how bnd implements a pluggable testing framework. With most tools that use bnd this information is hidden behind a pleasant GUI (sometimes). However, in certain cases it is necessary to understand how bnd handles testing. %0a%0a!!Model%0aIn the classic way testing consists of launching a new VM, dynamically loading the classes to be tested and then running the test framework on those. As this violates module boundaries as if they did not exist there is another way. %0a%0aIn bnd there is a header that allows a bundle to define what tests it contains:%0a%0a  Test-Cases ::= fqn+%0a%0aSuch a bundle therefore exports a number of test cases to the environment. These test cases can then be executed by the tester. The default tester in bnd is the biz.aQute.junit bundle, but this can be overridden because the launcher and the tester are pluggable.%0a%0aThe default tester can run in ''one shot'' mode or in ''automatic'' mode. The one shot mode is used in build tools to fire a test and parse the result. In this mode, the build tool provides the class names to test.%0a%0aIn automatic mode, the default tester creates a list of available bundles with test cases and executes all of them. Automatic mode can then end or it can run in continuous mode. Every time a bundle is started it will run the tests again. Continuous mode is intended for developing test bundles. You just run a framework and edit your test bundle's code. Any changes are saved and deployed, triggering the tests.%0a%0a!!Framework Properties for the Default Tester%0aThe default tester uses the project information to parametrize the tester's runtime component. However, it is also possible to set these runtime parameters explicitly with framework properties when you want to run the framework in automatic mode. The default tester obeys the following framework properties:%0a%0a||!Property||!Default||!Description||%0a||@@tester.port@@||-||The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.||%0a||@@tester.host@@||@@localhost@@|| The host to send the JUnit information to in a formatted defined by Eclipse. If this property is not set localhost is assumed.||%0a||@@tester.names@@||||Fully qualified names of classes to test. If this property is @@null@@ automatic mode is chosen, otherwise these classes are going to be tested and then the test ends.||%0a||@@tester.dir@@||@@testdir@@||A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a||@@tester.continuous@@||@@false@@||In automatic mode, no @@tester.names@@ set, continue watching the bundles and re-run a bundle's tests when it is started.||%0a||@@tester.trace@@||@@false@@||Trace the test framework in detail. Default is false, must be set to true or false.||%0a%0a!!How to set the Test-Cases Macro Automatically%0aThe Test-Cases macro can be set by hand but this can become a maintenance nightmare. A very useful macro is the @@${classes}@@ macro. This macro inspects the JAR and can find all classes that are considered test cases:%0a%0a  Test-Cases = ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}%0a%0aThis example looks for concrete classes that somehow extend the junit base class.%0a%0a!!Continuous Testing%0aTo setup an environment to test continuously, the following launcher can be used:%0a%0a  Test-Cases: ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}%0a  -runfw: org.apache.felix.framework%0a  -buildpath: osgi.core;version=[4.1','5), &#92;%0a	osgi.cmpn,  &#92;%0a	junit.osgi%0a  Private-Package: org.example.tests%0a  -runtrace: true%0a  -runbundles: biz.aQute.junit%0a  -runproperties:  &#92;%0a        tester.trace=true, &#92;%0a	tester.continuous=true, &#92;%0a	tester.dir=testdir%0a%0aThe example setup creates a bundle containing the org.example.tests package and sets the @@Test-Cases@@ header to all testcases in that package. If you run this setup, it runs the project bundle with the biz.aQute.junit bundle. This tester bundle is parametrized with the @@tester.*@@ properties to have trace on, test continuous, and put the test reports in @@./testdir@@.%0a%0aYou can find a bndtools project that shows this at [[https://github.com/bnd/aQute/tree/master/aQute.testing|Github]].%0a%0a!!Other Tester Frameworks%0aThe biz.aQute.junit is a normal bundle that gets started from the launcher framework. However, before bnd chooses the default tester, it scans the classpath of the launcher (set with @@-runpath@@) for JARs that have the following header set:%0a%0a  Tester-Plugin ::= fqn%0a%0aThe @@Tester-Plugin@@ header points to a class that must extend the @@aQute.bnd.build.ProjectTester@@ class. This class is loaded in the bnd environment and not in the target environment. This ProjectTester plugin then gets a chance to configure the launcher as it sees fit. It can get properties from the project and set these in the Project Launcher so they can be picked up in the target environment.%0a%0aAs this is a quite specific area the rest of the documentation is found in the source code.%0a
time=1308213050
title=28 Testing
author:1308213050=
diff:1308213050:1308212915:=22,23c22%0a%3c The default tester uses the project information to parametrize the tester's runtime component. However, it is also possible to set these runtime parameters explicitly with framework properties when you want to run the framework in automatic mode. The default tester obeys the following framework properties:%0a%3c %0a---%0a> The default tester obeys the following framework properties:%0a
host:1308213050=90.41.124.174
author:1308212915=
diff:1308212915:1308212894:=25c25%0a%3c ||@@tester.host@@||@@localhost@@|| The host to send the JUnit information to in a formatted defined by Eclipse. If this property is not set localhost is assumed.||%0a---%0a> ||@@tester.host@@||@@localhost@@|| The host to send the JUnit information to in a formated defined by Eclipse. If this property is not set localhost is assumed.||%0a
host:1308212915=90.41.124.174
author:1308212894=
diff:1308212894:1308212848:=27c27%0a%3c ||@@tester.dir@@||@@testdir@@||A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a---%0a> ||@@tester-dir@@||@@testdir@@||A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a
host:1308212894=90.41.124.174
author:1308212848=
diff:1308212848:1308211317:=56,57d55%0a%3c You can find a bndtools project that shows this at [[https://github.com/bnd/aQute/tree/master/aQute.testing|Github]].%0a%3c %0a
host:1308212848=90.41.124.174
author:1308211317=
diff:1308211317:1308211281:=63c63%0a%3c As this is a quite specific area the rest of the documentation is found in the source code.%0a---%0a>  %0a
host:1308211317=90.41.124.174
author:1308211281=
diff:1308211281:1308210956:=56,63c56%0a%3c !!Other Tester Frameworks%0a%3c The biz.aQute.junit is a normal bundle that gets started from the launcher framework. However, before bnd chooses the default tester, it scans the classpath of the launcher (set with @@-runpath@@) for JARs that have the following header set:%0a%3c %0a%3c   Tester-Plugin ::= fqn%0a%3c %0a%3c The @@Tester-Plugin@@ header points to a class that must extend the @@aQute.bnd.build.ProjectTester@@ class. This class is loaded in the bnd environment and not in the target environment. This ProjectTester plugin then gets a chance to configure the launcher as it sees fit. It can get properties from the project and set these in the Project Launcher so they can be picked up in the target environment.%0a%3c %0a%3c  %0a---%0a> !!Other Testers%0a
host:1308211281=90.41.124.174
author:1308210956=
diff:1308210956:1308210930:=44c44%0a%3c 	osgi.cmpn,  &#92;%0a---%0a> 	osgi.cmpn, %3c%3c%0a49,51c49,51%0a%3c   -runproperties:  &#92;%0a%3c         tester.trace=true, &#92;%0a%3c 	tester.continuous=true, &#92;%0a---%0a>   -runproperties: \\\%0a>         tester.trace=true,\\\%0a> 	tester.continuous=true,\\\%0a
host:1308210956=90.41.124.174
author:1308210930=
diff:1308210930:1308210684:=43,44c43,44%0a%3c   -buildpath: osgi.core;version=[4.1','5), &#92;%0a%3c 	osgi.cmpn, %3c%3c%0a---%0a>   -buildpath: osgi.core;version=[4.1','5), \u005c%0a> 	osgi.cmpn,\\\%0a
host:1308210930=90.41.124.174
author:1308210684=
diff:1308210684:1308210656:=43c43%0a%3c   -buildpath: osgi.core;version=[4.1','5), \u005c%0a---%0a>   -buildpath: osgi.core;version=[4.1','5),\\\\%0a
host:1308210684=90.41.124.174
author:1308210656=
diff:1308210656:1308210644:=43c43%0a%3c   -buildpath: osgi.core;version=[4.1','5),\\\\%0a---%0a>   -buildpath: osgi.core;version=[4.1','5),\\%0a
host:1308210656=90.41.124.174
author:1308210644=
diff:1308210644:1308210629:=43c43%0a%3c   -buildpath: osgi.core;version=[4.1','5),\\%0a---%0a>   -buildpath: osgi.core;version=[4.1','5),\\\%0a
host:1308210644=90.41.124.174
author:1308210629=
diff:1308210629:1308210599:=43,44c43,44%0a%3c   -buildpath: osgi.core;version=[4.1','5),\\\%0a%3c 	osgi.cmpn,\\\%0a---%0a>   -buildpath: osgi.core;version=[4.1','5),\%0a> 	osgi.cmpn,\%0a49,51c49,51%0a%3c   -runproperties: \\\%0a%3c         tester.trace=true,\\\%0a%3c 	tester.continuous=true,\\\%0a---%0a>   -runproperties: \%0a>         tester.trace=true,\%0a> 	tester.continuous=true,\%0a
host:1308210629=90.41.124.174
author:1308210599=
diff:1308210599:1308210216:=39,56d38%0a%3c To setup an environment to test continuously, the following launcher can be used:%0a%3c %0a%3c   Test-Cases: ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}%0a%3c   -runfw: org.apache.felix.framework%0a%3c   -buildpath: osgi.core;version=[4.1','5),\%0a%3c 	osgi.cmpn,\%0a%3c 	junit.osgi%0a%3c   Private-Package: org.example.tests%0a%3c   -runtrace: true%0a%3c   -runbundles: biz.aQute.junit%0a%3c   -runproperties: \%0a%3c         tester.trace=true,\%0a%3c 	tester.continuous=true,\%0a%3c 	tester.dir=testdir%0a%3c %0a%3c The example setup creates a bundle containing the org.example.tests package and sets the @@Test-Cases@@ header to all testcases in that package. If you run this setup, it runs the project bundle with the biz.aQute.junit bundle. This tester bundle is parametrized with the @@tester.*@@ properties to have trace on, test continuous, and put the test reports in @@./testdir@@.%0a%3c %0a%3c !!Other Testers%0a
host:1308210599=90.41.124.174
author:1308210216=
diff:1308210216:1308210020:=6,8d5%0a%3c This section describes how bnd implements a pluggable testing framework. With most tools that use bnd this information is hidden behind a pleasant GUI (sometimes). However, in certain cases it is necessary to understand how bnd handles testing. %0a%3c %0a%3c !!Model%0a21d17%0a%3c !!Framework Properties for the Default Tester%0a31c27%0a%3c !!How to set the Test-Cases Macro Automatically%0a---%0a> !!How to set the Test-Cases macro%0a37,38c33,34%0a%3c %0a%3c !!Continuous Testing%0a---%0a> !!biz.aQute.junit%0a> !!Continuous Testing%0a\ No newline at end of file%0a
host:1308210216=90.41.124.174
author:1308210020=
diff:1308210020:1308209988:=19c19%0a%3c ||!Property||!Default||!Description||%0a---%0a> %0a
host:1308210020=90.41.124.174
author:1308209988=
diff:1308209988:1308209962:=22,23c22,23%0a%3c ||@@tester.names@@||||Fully qualified names of classes to test. If this property is @@null@@ automatic mode is chosen, otherwise these classes are going to be tested and then the test ends.||%0a%3c ||@@tester-dir@@||@@testdir@@||A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a---%0a> ||@@tester.names@@||Fully qualified names of classes to test. If this property is @@null@@ automatic mode is chosen, otherwise these classes are going to be tested and then the test ends.||%0a> ||@@tester-dir@@||@@testdir@@A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a
host:1308209988=90.41.124.174
author:1308209962=
diff:1308209962:1308209946:=20c20%0a%3c ||@@tester.port@@||-||The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.||%0a---%0a> ||@@tester.port@@||||The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.||%0a
host:1308209962=90.41.124.174
author:1308209946=
diff:1308209946:1308209882:=20,21c20,21%0a%3c ||@@tester.port@@||||The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.||%0a%3c ||@@tester.host@@||@@localhost@@|| The host to send the JUnit information to in a formated defined by Eclipse. If this property is not set localhost is assumed.||%0a---%0a> ||@@tester.port@@||The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.||%0a> ||@@tester.host@@|| The host to send the JUnit information to in a formated defined by Eclipse. If this property is not set localhost is assumed.||%0a23,26c23,26%0a%3c ||@@tester-dir@@||@@testdir@@A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a%3c ||@@tester.continuous@@||@@false@@||In automatic mode, no @@tester.names@@ set, continue watching the bundles and re-run a bundle's tests when it is started.||%0a%3c ||@@tester.trace@@||@@false@@||Trace the test framework in detail. Default is false, must be set to true or false.||%0a%3c %0a---%0a> ||@@tester-dir@@||A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a> ||@@tester.continuous@@||In automatic mode, no @@tester.names@@ set, continue watching the bundles and re-run a bundle's tests when it is started.||%0a> ||@@tester.trace@@||Trace the test framework in detail. Default is false, must be set to true or false.||%0a> %0a
host:1308209946=90.41.124.174
author:1308209882=
diff:1308209882:1308208604:=12,26c12,13%0a%3c Such a bundle therefore exports a number of test cases to the environment. These test cases can then be executed by the tester. The default tester in bnd is the biz.aQute.junit bundle, but this can be overridden because the launcher and the tester are pluggable.%0a%3c %0a%3c The default tester can run in ''one shot'' mode or in ''automatic'' mode. The one shot mode is used in build tools to fire a test and parse the result. In this mode, the build tool provides the class names to test.%0a%3c %0a%3c In automatic mode, the default tester creates a list of available bundles with test cases and executes all of them. Automatic mode can then end or it can run in continuous mode. Every time a bundle is started it will run the tests again. Continuous mode is intended for developing test bundles. You just run a framework and edit your test bundle's code. Any changes are saved and deployed, triggering the tests.%0a%3c %0a%3c The default tester obeys the following framework properties:%0a%3c %0a%3c ||@@tester.port@@||The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.||%0a%3c ||@@tester.host@@|| The host to send the JUnit information to in a formated defined by Eclipse. If this property is not set localhost is assumed.||%0a%3c ||@@tester.names@@||Fully qualified names of classes to test. If this property is @@null@@ automatic mode is chosen, otherwise these classes are going to be tested and then the test ends.||%0a%3c ||@@tester-dir@@||A directory to put the test reports. If the directory does not exist, no reports are generated. The default is @@testdir@@ in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports||%0a%3c ||@@tester.continuous@@||In automatic mode, no @@tester.names@@ set, continue watching the bundles and re-run a bundle's tests when it is started.||%0a%3c ||@@tester.trace@@||Trace the test framework in detail. Default is false, must be set to true or false.||%0a%3c %0a---%0a> Such a bundle therefore exports a number of test cases to the environment. These test cases can then be executed by the tester.%0a> %0a
host:1308209882=90.41.124.174
author:1308208604=
diff:1308208604:1308208604:=1,21d0%0a%3c (:title 28 Testing:)%0a%3c %0a%3c http://www.aqute.biz/uploads/Code/bnd.png%0a%3c %0a%3c !28 Testing%0a%3c In the classic way testing consists of launching a new VM, dynamically loading the classes to be tested and then running the test framework on those. As this violates module boundaries as if they did not exist there is another way. %0a%3c %0a%3c In bnd there is a header that allows a bundle to define what tests it contains:%0a%3c %0a%3c   Test-Cases ::= fqn+%0a%3c %0a%3c Such a bundle therefore exports a number of test cases to the environment. These test cases can then be executed by the tester.%0a%3c %0a%3c !!How to set the Test-Cases macro%0a%3c The Test-Cases macro can be set by hand but this can become a maintenance nightmare. A very useful macro is the @@${classes}@@ macro. This macro inspects the JAR and can find all classes that are considered test cases:%0a%3c %0a%3c   Test-Cases = ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}%0a%3c %0a%3c This example looks for concrete classes that somehow extend the junit base class.%0a%3c !!biz.aQute.junit%0a%3c !!Continuous Testing%0a\ No newline at end of file%0a
host:1308208604=90.41.124.174
